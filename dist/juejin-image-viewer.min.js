/**
 * juejin-image-viewer v2.0.0
 * (c) 2017 WEBuster <webuster@xitu.io>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.JuejinImageViewer=e()}(this,function(){"use strict";function t(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.addEventListener(e,n,i),function(){t.removeEventListener(e,n,i)}}function e(){var t=document.documentElement;return{width:Math.max(t.clientWidth,window.innerWidth||0),height:Math.max(t.clientHeight,window.innerHeight||0)}}function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.getElementsByTagName("head")[0],i=document.getElementById(e)||document.createElement("style");return i.innerHTML=t,e&&(i.id=e),n.contains(i)||n.appendChild(i),function(){i.remove()}}function i(t,e,n){if(t){var i=new Image;i.onload=function(){e&&e(t)},i.onerror=function(){n&&n(t)},i.src=t}}function o(){document.body.clientWidth}!function(){function t(t){this.value=t}function e(e){function n(o,r){try{var a=e[o](r),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){n("next",t)},function(t){n("throw",t)}):i(a.done?"return":"normal",a.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?n(o.key,o.arg):r=null}var o,r;this._invoke=function(t,e){return new Promise(function(i,a){var s={key:t,arg:e,resolve:i,reject:a,next:null};r?r=r.next=s:(o=r=s,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u={targetFilter:function(t){return"IMG"===t.nodeName&&t.naturalWidth},urlGetter:function(t){return t.getAttribute("src")},eventName:"click",containerClassName:"juejin-image-viewer__container",boxClassName:"juejin-image-viewer__box",imageClassName:"juejin-image-viewer__image",cursor:"zoom-in",backgroundColor:"#fff",transitionDuration:200,margin:0,parent:null};return function(){function c(t,e){r(this,c),this.initContainerList(t),this.initOptions(e),this.initCSS(),this.startListen()}return a(c,[{key:"initContainerList",value:function(t){"string"==typeof t?this.containerList=[].slice.call(document.querySelectorAll(t)):t instanceof Array?this.containerList=t:this.containerList=[t]}},{key:"initCSS",value:function(){var t=this.options,e=(t.containerClassName,t.boxClassName),i=t.imageClassName,o=t.transitionDuration;this.removeCSS=n("\n      ."+e+" {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        z-index: 1;\n        transition: all "+o+"ms ease-out;\n      }\n      ."+e+".hide {\n        opacity: 0;\n      }\n      ."+e+",\n      ."+e+" ."+i+" {\n        cursor: zoom-out;\n      }\n      ."+i+" {\n        position: absolute;\n        transition: all "+o+"ms ease-out;\n      }\n    ")}},{key:"initOptions",value:function(t){this.options=s({},u,t)}},{key:"startListen",value:function(){var t=this;this.ListenerRemoverList=this.containerList.map(function(e){return{removeEventListener:t.listenContainer(e),container:e}})}},{key:"listenContainer",value:function(e){var n=this;return e.classList.add(this.options.containerClassName),t(e,this.options.eventName,function(t){n.shouldShow(t.target)&&n.show(t.target)},!0)}},{key:"shouldShow",value:function(t){return this.options.targetFilter(t)&&!t.classList.contains(this.options.imageClassName)}},{key:"show",value:function(e){var n=e.getAttribute("src"),i=this.options.urlGetter(e),r=e.naturalWidth,a=e.naturalHeight,s=e.getBoundingClientRect(),u=this.computeRenderedRect(r,a),c=document.createElement("div"),l=document.createElement("img"),h=this.options.parent||document.body;l.src=n,l.width=r,l.height=a,l.className=this.options.imageClassName,l.style.transform=this.computeTransform(s,u),this.applyRect(u,l),this.box=c,c.className=this.options.boxClassName,c.appendChild(l),h.appendChild(c),o(),l.style.transform="",c.style.backgroundColor=this.options.backgroundColor,t(c,"click",this.hide.bind(this)),t(window,"resize",this.hide.bind(this)),t(window,"scroll",this.hide.bind(this)),i!==n&&this.loadIamge(i,l)}},{key:"applyRect",value:function(t,e){e.style.top=t.top+"px",e.style.left=t.left+"px",e.style.width=t.width+"px",e.style.height=t.height+"px"}},{key:"loadIamge",value:function(t,e){var n=this;this.box.classList.add("loading"),i(t,function(i){e.src=t,e.width=e.naturalWidth,e.height=e.naturalHeight;var o=n.computeRenderedRect(e.naturalWidth,e.naturalHeight);n.applyRect(o,e),n.box.classList.remove("loading"),n.box.classList.add("loaded")},function(){n.box.classList.remove("loading"),n.box.classList.add("error")})}},{key:"computeRenderedRect",value:function(t,n){var i=e(),o=this.options.margin,r=t/(i.width-2*o),a=n/(i.height-2*o),s=Math.max(r,a,1),u=t/s,c=n/s;return{top:(i.height-c)/2,left:(i.width-u)/2,width:u,height:c}}},{key:"computeTransform",value:function(t,e){var n=t.width/e.width,i=t.height/e.height,o=t.width-e.width,r=t.height-e.height,a=t.top-e.top+r/2;return"translate3d("+(t.left-e.left+o/2)+"px, "+a+"px, 0)"+" "+("scale3d("+n+", "+i+", 1)")}},{key:"hide",value:function(){var t=this.box;t&&(t.classList.add("hide"),setTimeout(function(){t.remove(),o()},this.options.transitionDuration))}},{key:"destroy",value:function(){var t=this;this.ListenerRemoverList&&this.ListenerRemoverList.forEach(function(e){e.container.classList.remove(t.options.containerClassName),e.removeEventListener()}),this.removeCSS&&this.removeCSS()}}]),c}()});
