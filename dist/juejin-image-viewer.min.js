/**
 * juejin-image-viewer v1.0.0
 * (c) 2017 WEBuster <webuster@xitu.io>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.JuejinImageViewer=e()}(this,function(){"use strict";function t(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.addEventListener(e,n,i),function(){t.removeEventListener(e,n,i)}}function e(){var t=document.documentElement;return{width:Math.max(t.clientWidth,window.innerWidth||0),height:Math.max(t.clientHeight,window.innerHeight||0)}}function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.getElementsByTagName("head")[0],i=document.getElementById(e)||document.createElement("style");return i.innerHTML=t,e&&(i.id=e),n.contains(i)||n.appendChild(i),function(){i.remove()}}function i(t,e,n){if(t){var i=new Image;i.onload=function(){e&&e(t)},i.onerror=function(){n&&n(t)},i.src=t}}function o(){document.body.clientWidth}!function(){function t(t){this.value=t}function e(e){function n(o,r){try{var s=e[o](r),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):i(s.done?"return":"normal",s.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?n(o.key,o.arg):r=null}var o,r;this._invoke=function(t,e){return new Promise(function(i,s){var a={key:t,arg:e,resolve:i,reject:s,next:null};r?r=r.next=a:(o=r=a,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u={urlHandler:function(t){return t},urlAttribute:"src",eventName:"click",containerClassName:"juejin-image-viewer__container",boxClassName:"juejin-image-viewer__box",imageClassName:"juejin-image-viewer__image",cursor:"zoom-in",backgroundColor:"#fff",transitionDuration:200};return function(){function c(t,e){r(this,c),this.initContainerList(t),this.initOptions(e),this.initCSS(),this.startListen()}return s(c,[{key:"initContainerList",value:function(t){"string"==typeof t?this.containerList=[].slice.call(document.querySelectorAll(t)):t instanceof Array?this.containerList=t:this.containerList=[t]}},{key:"initCSS",value:function(){this.removeCSS=n("\n      ."+this.options.containerClassName+" img {\n        cursor: "+this.options.cursor+";\n      }\n      ."+this.options.boxClassName+" {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        z-index: 1;\n        transition: all "+this.options.transitionDuration+"ms ease-out;\n      }\n      ."+this.options.boxClassName+".hide {\n        opacity: 0;\n      }\n      ."+this.options.boxClassName+",\n      ."+this.options.boxClassName+" ."+this.options.imageClassName+" {\n        cursor: zoom-out;\n      }\n      ."+this.options.imageClassName+" {\n        position: absolute;\n        transition: all "+this.options.transitionDuration+"ms ease-out;\n      }\n    ")}},{key:"initOptions",value:function(t){this.options=a({},u,t)}},{key:"startListen",value:function(){var t=this;this.ListenerRemoverList=this.containerList.map(function(e){return{removeEventListener:t.listenContainer(e),container:e}})}},{key:"listenContainer",value:function(e){var n=this;return e.classList.add(this.options.containerClassName),t(e,this.options.eventName,function(t){n.shouldShow(t.target)&&n.show(t.target)},!0)}},{key:"shouldShow",value:function(t){return"IMG"===t.nodeName&&t.naturalWidth&&!t.classList.contains(this.options.imageClassName)}},{key:"show",value:function(e){var n=e.getAttribute("src"),i=e.getAttribute(this.options.urlAttribute),r=this.options.urlHandler(i),s=e.naturalWidth,a=e.naturalHeight,u=e.getBoundingClientRect(),c=this.computeRenderedRect(s,a),l=document.createElement("div"),h=document.createElement("img");h.src=n,h.className=this.options.imageClassName,h.style.transform=this.computeTransform(u,c),this.applyRect(c,h),this.box=l,l.className=this.options.boxClassName,l.appendChild(h),document.body.appendChild(l),o(),h.style.transform="",l.style.backgroundColor=this.options.backgroundColor,t(l,"click",this.hide.bind(this)),t(window,"resize",this.hide.bind(this)),t(window,"scroll",this.hide.bind(this)),r!==n&&this.loadIamge(r,h)}},{key:"applyRect",value:function(t,e){e.style.top=t.top+"px",e.style.left=t.left+"px",e.style.width=t.width+"px",e.style.height=t.height+"px"}},{key:"loadIamge",value:function(t,e){var n=this;i(t,function(i){e.src=t;var o=n.computeRenderedRect(e.naturalWidth,e.naturalHeight);n.applyRect(o,e)})}},{key:"computeRenderedRect",value:function(t,n){var i=e(),o=t/i.width,r=n/i.height,s=Math.max(o,r),a=t/s,u=n/s;return{top:(i.height-u)/2,left:(i.width-a)/2,width:a,height:u}}},{key:"computeTransform",value:function(t,e){var n=t.width/e.width,i=t.height/e.height,o=t.width-e.width,r=t.height-e.height,s=t.top-e.top+r/2;return"translate3d("+(t.left-e.left+o/2)+"px, "+s+"px, 0)"+" "+("scale3d("+n+", "+i+", 1)")}},{key:"hide",value:function(){var t=this.box;t&&(t.classList.add("hide"),setTimeout(function(){t.remove(),o()},this.options.transitionDuration))}},{key:"destroy",value:function(){var t=this;this.ListenerRemoverList&&this.ListenerRemoverList.forEach(function(e){e.container.classList.remove(t.options.containerClassName),e.removeEventListener()}),this.removeCSS&&this.removeCSS()}}]),c}()});
